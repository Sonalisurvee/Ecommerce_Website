{% extends 'userpanel/userbase.html' %}
{% block title %}Checkout{% endblock title %}
{% block body %}

<style>
  .billing_details form {
    padding-top: 20px
  }

  /* .checkout_area input {
    border: 1px solid black;
  } */        


  /* .checkout_area .form-control {
    border: 1px solid black;
  } */

  /* .returning_customer .form-control {
    border: 1px solid black;
  } */

  .cap {
    background-color: #795376;
    color: white;
  }


  
  a {
    color: black;
    text-decoration: none;
  }

  .section_padding {
    padding-top: 30px;
  }

  .breadcrumb_part {
    height: 100px;
  }

  .breadcrumb_iner h3 {
    font-size: 35px;
    line-height: 1.2;
    color: #fff;
    font-weight: 500;
  }
</style>


<!-- breadcrumb part start-->
<section class="breadcrumb_part">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="breadcrumb_iner">
          <h3>Checkout</h3>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- breadcrumb part end -->

<!--================Checkout Area =================-->

<section class="checkout_area section_padding">
  <div class="container">

    <!-- ------------------------------------------------------- coupan-area---------------------------------------------------------------- -->

    <div class="cupon_area">
      <div class="check_title">
        <h2>
          COUPON
          <!-- <a href="#">Click here to enter your code</a> -->
        </h2>
      </div>
      <form method="post">

        {% csrf_token %}
        <div class="col-md-3 mt-3">
          {% include 'message.html' %}
        </div>
        <input type="text" name="coupon" placeholder="Enter coupon code" />
        <button type="submit" class="tp_btn" href="#">Apply Coupon</button>
        {% if cart.coupon %}
        <a href="{% url 'remove_coupan' %}" class="btn btn-success">{{cart.coupon.discount_price}} off is applied on product</a>
        {% endif %}
      </form>
    </div>

    <!-- ------------------------------------------------------- billing-area---------------------------------------------------------------- -->


    <div class="billing_details">
      <div class="row">
        <div class="col-lg-6">
          <div class="check_title">
            <h2>Billing Details</h2>
          </div>

          <form class="row contact_form" action="" method="post">
            <div class="col-md-12 form-group p_star">
              <input type="text" class="form-control" id="first" name="fullname" />

              <span class="placeholder" data-placeholder="Full name">{{ name.full_name }}</span>
            </div>


            <!-- ------------------------------------------------------- address-area---------------------------------------------------------------- -->


          </form>
          {% if user_addresses %}
          <div class="check_title" style="padding-bottom: 20px;">
            <h2>Your Address</h2>
          </div>
          {% endif %}

          {% for a in user_addresses %}
          {% if not a.id == default.default.id %}
          <!-- <h3 style="padding-top:15px">{{forloop.counter}} and {{default.default.id}}</h3> -->
          <div class="card  mb-3">
            <div class="card-body">
              <div class="text-center">
                {% if a.default %}
                Default
                <hr>
                {% endif %}
              </div>
              <h5 class="card-title">{{a.house_name}}, {{a.pincode}}</h5>
              <p class="card-text">{{a.city}}, </p>
              <div>
             
                <a class="btn btn-light m-1" href="{% url 'edit_address' a.id 2 %}">
                  Edit
                </a>

                <a class="btn cap m-1" data-bs-toggle="modal" data-bs-target="#deletaddress{{forloop.counter}}"
                  href="{% url 'delete_address' a.id 2 %}">
                  Delete
                </a>

                <a class="btn btn-light m-1" href="{% url 'default_address' a.id 2 %}">
                  Default
                </a>

                <!--Edit Modal -->
                <div class="modal fade " id="deletaddress{{forloop.counter}}" tabindex="-1"
                  aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="" id="exampleModalLabel">Delete</h5>
                        <button type="button" class="btn" data-bs-dismiss="modal" aria-label="Close"> <i
                            class="fa fa-cancel"></i>X </button>
                      </div>
                      <div class="modal-body">
                        <p>Are you sure to delete Address <span class="text-primary">" {{a.house_name}}
                            ..."</span></p>
                        <form action="#" enctype="multipart/form-data" method="POST">
                          {% csrf_token %}
                          <div class="d-flex justify-content-center">
                            <button type="submit"
                              class="btn btn-danger btn-lg gradient-custom-4 w-50 text-light">Confirm</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}
          <div class="m-2">
            <a class="btn cap" href="{% url 'add_address' %}">Add new address</a></button>
          </div>
        </div>


        <!-- ------------------------------------------------------- side bar for order ----------------------------------------------------------- -->

        <div class="col-lg-6">
          <div class="order_box">
            <h2 class="text-center">Your Order</h2>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col"></th>
                  <th scope="col">Product</th>
                  <th scope="col">Price</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total</th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items %}
                <tr>
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img src="{{ cart_item.products.image.url }}" alt="" width="100px" />
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="media-body">
                      <p>{{ cart_item.products.product_name }}</p>
                    </div>
                  </td>
                  <td>
                    <h5>{{ cart_item.products.price }}</h5>
                  </td>

                  <td>
                    <h5>{{ cart_item.quantity }}</h5>
                  </td>
                  <td>
                    <h5>{{ cart_item.sub_total }}</h5>
                  </td>
                </tr>

                {% endfor %}
              </tbody>
            </table>

            <hr>
            {% if cart.coupon %}
            <a href="#" class="btn btn-success">{{cart.coupon.discount_price}} off is applied on product</a>
            <br>
            <hr>
            {% endif %}


            <ul class="list list_2">
              <li>
                <a href="#">Subtotal
                  <span>$ {{ cart.get_cart_total }}</span>
                </a>
              </li>
              <!-- <li>
                <a href="#">Shipping
                  <span>Flat rate: $50.00</span>
                </a>
              </li> -->
              <li>
                <a href="#">Tax
                  <span>$ {{ cart.get_tax }}</span>
                </a>
              </li>
              <li>
                <a href="#">Grand Total
                  <span>$ {{ cart.get_grand_total }}</span>
                </a>
              </li>
            </ul>


            <div class="payment_item">
              <hr>
              <h2 class="text-center">Payment</h2>
              <p class="text-center">Cash On Delivery</p>
              <!-- <div class="radion_btn">
                <input type="radio" id="f-option5" name="selector" />
                <label for="f-option5">Check payments</label>
                <div class="check"></div>
              </div>
              <p>
                Please send a check to Store Name, Store Street, Store Town,
                Store State / County, Store Postcode.
              </p>
            </div>
            <div class="payment_item active">
              <div class="radion_btn">
                <input type="radio" id="f-option6" name="selector" />
                <label for="f-option6">Paypal </label>
                <img src="img/product/single-product/card.jpg" alt="" />
                <div class="check"></div>
              </div>
              <p>
                Please send a check to Store Name, Store Street, Store Town,
                Store State / County, Store Postcode.
              </p>
            </div>       -->
              <br>



              <!-- id='rzp-button' is the thing because it is getting connected with the script below -->
              <a class="btn_3" id="rzp-button1" href="">Proceed to Paypal</a>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>
<!--================End Checkout Area =================-->


<!-- Razorpay scripts-->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
var options = {
    "key": "rzp_test_a0WKFGxNpEjkyL", // Enter the Key ID generated from the Dashboard
    "amount": "{{payment.amount}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Signora",
    "description": "Order Payment",
    "image": "https://example.com/your_logo",
    "order_id": "{{payment.id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){

      window.location.href = `http://127.0.0.1:8000/cart/success/?razorpay_payment_id=${response.razorpay_payment_id}&order_id=${response.razorpay_order_id}&razorpay_signature=${response.razorpay_signature}`


        // alert(response.razorpay_payment_id);
        // alert(response.razorpay_order_id);
        // alert(response.razorpay_signature)
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9000090000"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
rzp1.on('payment.failed', function (response){
        alert(response.error.code);
        alert(response.error.description);
        alert(response.error.source);
        alert(response.error.step);
        alert(response.error.reason);
        alert(response.error.metadata.order_id);
        alert(response.error.metadata.payment_id);
});
document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>




{% endblock body %}